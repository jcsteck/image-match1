(function(e,l){function d(n,t,s){var c=n.concat(),p=n.length-1,m=+new Date;y(function q(){do{if(p--,t(c.shift(),p)===u){return}}while(0<c.length&&50>+new Date-m);0<c.length?y(q,25):s(n)},25)}function k(n,s,q){for(var c=n.concat(),p=n.length,m;Boolean(m=c.shift());){if(p--,s(m,p)===u){return}}q(n)}function j(D,A,n,C){var s,q,B,t,F,E,p=C?C:r?+new Date:i;x(D,function(ab){var aa=ab.getContext(h).getImageData(0,0,ab.width,ab.height),Z=JSON.stringify([].slice.call(aa.data)),S=u;if(null!==B&&0!==B.localeCompare(Z)){var S=ab.width,K=ab.height,U=aa.data,H=t.data,T=0,Z=l.createElement(g),R=Z.getContext(h),P=R.createImageData(S,K),W=P.data,X,m,V=X=0,Y=0;X=W.length;var c,Q,O,N,M,L,J,I;Z.width=S;Z.height=K;Z.style.border="#000 1px solid";for(X-=1;0<X;X-=4){W[X]=255}K=aa.height*aa.width;for(m=aa.height;m--;){for(X=aa.width;X--;){V=4*(m*S+X),Y=4*(m*aa.width+X),c=U[Y+0],Q=U[Y+1],O=U[Y+2],N=U[Y+3],M=H[Y+0],L=H[Y+1],J=H[Y+2],I=H[Y+3],c===M&&Q===L&&O===J&&N===I?(W[V+0]=Math.abs(c-M),W[V+1]=Math.abs(Q-L),W[V+2]=Math.abs(O-J),W[V+3]=Math.abs(N-I)):(T++,W[V+0]=U[Y+0],W[V+1]=U[Y+1],W[V+2]=U[Y+2],W[V+3]=U[Y+3])}}R.putImageData(P,0,0);aa=Math.abs(100*((T-K)/K));s=parseFloat(aa);q=Z;E=s;if(S=f>E){o&&o.appendChild(q),ab.className="fail",r&&(F=+new Date-p),n(ab,F,E)}return S}t=aa;B=Z},function(c){r&&(F=+new Date-p);A(c,F,E)})}function b(n,s,t,m){var q=r?+new Date:i;w=[];x(s,function(A,C){var B,D;B=l.createElement(g);B.id="canvasCompare_"+C;w.push(B);B.width=A.width;B.height=A.height;n.appendChild(B);D=new Image;D.onload=function(){v++;(void 0).drawImage(D,0,0)};D.onerror=function(){v++};D.src=A.src},function p(c){v<c.length?y(function(){p(c)},25):j(w,t,m,q)})}function z(){}var u=!1,i,g="canvas",h="2d",y=setTimeout,r=u,o,f=100,a=u,v=0,w=[],x=k;z.prototype.setDebug=function(c){return r=c};z.prototype.setAsynchronous=function(c){x=(a=c)?d:k;return c};z.prototype.showDiffInCanvas=function(c){return o=c};z.prototype.setTolerance=function(c){return f=c};z.prototype.compare=function(n,p,q,m){n.nodeType?b.apply(this,arguments):j.apply(this,arguments)};z.prototype.image=function(m,n,p){this.src=m+(-1===m.indexOf("?")?"?":"&")+ +new Date;this.width=n;this.height=p};e.IM=new z})(window,document);